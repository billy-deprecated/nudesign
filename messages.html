<!--Nu Designs 6.813 project: inclass, Messages page-->
<!--Messages Template -->
<!DOCTYPE html>

<!-- <div id="mainWindow">
  <div id="top-bar">
    <div class="welcome-message"> Messages</div>
    <button class="btn btn-danger" type="button" id="logout-button">Logout</button>
    <div id="language-group">
      <div id="language-icon"><span class="flag-icon flag-icon-us"></div>
      <button class="btn btn-success" type="button" id="language-button">English</button>
    </div>

  </div>
  <div id="mode-panel">
  </div>
</div> -->
<script>
$(".welcome-message").remove();
$("#top-bar").append("<div class='welcome-message'> Messages</div>");
</script>

<div id='messages-container'>
  <div id='messages-attachments-pane'>
  	<div id='messaging-contact'>
  		<div id='messaging-profile-pic'></div>
  		<div >
  			<div class='contact-name contact-info'>Ms. Laura</div>
  			<div class='contact-info'>123-456-7890</div>
  			<div class='contact-info'>imsmart@mit.edu</div>
  		</div>
  	</div>
  	<div id='attachments-list'>
  		<div class="attachment-row">
	  		<div class="attachment">
	  			<div class="attachment-pic word"></div>
	  			<span class="attachment-label">Math Review 2/19</span>
	  		</div>
	  		<div class="attachment">
	  			<div class="attachment-pic word"></div>
	  			<span class="attachment-label">Fractions 2/8</span>
	  		</div>
  		</div>
  		<div class="attachment-row">
	  		<div class="attachment">
	  			<div class="attachment-pic word"></div>
	  			<span class="attachment-label">Art wksht 2/7</span>
	  		</div>
	  		<div class="attachment" title="Countries review 1/15">
	  			<div class="attachment-pic ppt"></div>
	  			<span class="attachment-label">Countries review 1/15</span>
	  		</div>
  		</div>
  		<div class="attachment-row">
	  		<div class="attachment">
	  			<div class="attachment-pic excel"></div>
	  			<span class="attachment-label">Grade report Q2</span>
	  		</div>
	  		<div class="attachment">
	  			<div class="attachment-pic word"></div>
	  			<span class="attachment-label">Spelling unit 6</span>
	  		</div>
  		</div>
  	</div>
  </div>
  <div id='messages-list'>
  </div>
  <div id='messages-input-container'>
    <form id="send-message-form">
	  	<label class="btn btn-default btn-file send-attachment">
		    <input type="file" id="file-input" hidden>
		</label>
	  	<input type='text' id='messages-input' autocomplete="off"/>
	  	<button class="btn btn-primary" type="submit" id="send-message-button">Send</button>
  	</form>
  </div>

</div>
<script type="text/javascript">
	var messageId = 5;
	var stockMessages = ["This is lit af dude", "Robby is a genius", "You're a wonderful parent", "Hi Laura", "You need to come in and teach Robby fractions", "Thank you", "Random messages ftw"];
	function SendMessage(){
		var text = $("#messages-input").val();
		var file = $("#file-input").val();
		console.log(file);
		if (text !== ""){
			$("#messages-input").val("");
			var list = $("#messages-list");
			messageId++;
			var time = new Date();
			time = time.toDateString();
			list.append("<div class='message'> <div class='sent message-bubble' id='message-"+messageId+"'><div class='message-time'>"+time+"</div>"+text+"</div></div>");
			list.animate({
			    scrollTop: list[0].scrollHeight
			}, 1000);
			generateRandomMessage();
		}
		if (file !== ""){
			$("#file-input").val("");
			var fileArray = file.split("\\");
			text = fileArray[fileArray.length - 1];
			var list = $("#messages-list");
			messageId++;
			var time = new Date();
			time = time.toDateString();
			list.append("<div class='message'> <div class='sent message-bubble' id='message-"+messageId+"'><div class='message-time'>"+time+"</div>"+text+"</div></div>");
			list.animate({
			    scrollTop: list[0].scrollHeight
			}, 1000);
			generateRandomMessage();
		}

	}
	function generateRandomMessage() {
		setTimeout(receiveMessage, Math.floor(Math.random() * (5000)));
	}
	function receiveMessage() {
	    var text = stockMessages[Math.floor(Math.random() * (stockMessages.length))];
		var list = $("#messages-list");
		messageId++;
		var time = new Date();
		time = time.toDateString();
		list.append("<div class='message'> <div class='received message-bubble' id='message-"+messageId+"'><div class='message-time'>"+time+"</div>"+text+"</div></div>");
		list.animate({
		    scrollTop: list[0].scrollHeight
		}, 1000);

	}
	/*$("#send-message-button").click(SendMessage);
	$('#messages-input').keypress(function(event) {
    if (event.keyCode == 13 || event.which == 13) {
        SendMessage();
    }*/
    $("#send-message-form").submit(function(e){
    	console.log("bitches");
    	e.preventDefault();
    	SendMessage();
    	return false;
    });
</script>
